<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>অনুসন্ধান - আমাদের জন্য আমরা</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK এবং কনফিগারেশন (Common Setup) -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import { getAuth } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
      
      const firebaseConfig = {
        apiKey: "AIzaSyDu8VDVXEbrLbqPmD24OPgNhbH5xjwi_vA",
        authDomain: "we4usnur.firebaseapp.com",
        projectId: "we4usnur",
        storageBucket: "we4usnur.firebasestorage.app",
        messagingSenderId: "1069907132834",
        appId: "1:1069907132834:web:f6aec92fc61c413767f2fb",
        measurementId: "G-LZCCHNFRSN"
      };

      // Initialize Firebase (Optional for this page, but good for consistency)
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      window.auth = auth;
    </script>

    <style>
        /* CSS অপরিবর্তিত রাখা হয়েছে */
        :root {
            --primary: #e53935;
            --primary-dark: #c62828;
            --secondary: #f5f5f5;
            --text: #333;
            --text-light: #666;
            --white: #fff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { scroll-behavior: smooth; }
        body { background-color: var(--secondary); color: var(--text); line-height: 1.6; }
        .container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .btn { padding: 10px 20px; border-radius: 30px; font-weight: 600; cursor: pointer; transition: var(--transition); border: none; font-size: 0.9rem; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: var(--white); }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-primary[disabled] { background: #ccc; cursor: not-allowed; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline[disabled] { border-color: #ccc; color: #ccc; cursor: not-allowed; }
        .btn-outline[disabled]:hover { background: transparent; color: #ccc; }
        .btn-outline:not([disabled]):hover { background: var(--primary); color: var(--white); }
        .page-view { display: block; min-height: 100vh; }
        .search-view-content { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .search-container { background-color: var(--white); border-radius: 30px; box-shadow: var(--shadow); padding: 40px; width: 100%; max-width: 600px; position: relative; }
        .search-title { text-align: center; margin-bottom: 30px; color: var(--text); font-size: 1.8rem; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .search-title i { color: var(--primary); }
        .search-form { display: flex; flex-direction: column; gap: 20px; }
        .search-form .form-group label { weight: 500; color: var(--text); display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
        .search-form .form-group label i { color: var(--primary); width: 20px; }
        .search-form .form-control { padding: 12px 15px; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; transition: var(--transition); background-color: #f9f9f9; }
        .search-form .form-control:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(229, 57, 53, 0.2); background-color: var(--white); }
        .search-btn { padding: 15px; border-radius: 10px; font-weight: 600; font-size: 1.1rem; margin-top: 10px; }
        .search-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(229, 57, 53, 0.3); }
        .back-link { text-align: center; margin-top: 20px; }
        .back-link a { color: var(--primary); text-decoration: none; font-weight: 500; cursor: pointer; display: inline-flex; align-items: center; gap: 5px; }
        .back-link a:hover { text-decoration: underline; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @media (max-width: 768px) { }
    </style>
</head>
<body>
    <!-- Search Page View -->
    <div class="page-view" id="searchPageView">
        <div class="search-view-content">
            <div class="search-container">
                <h1 class="search-title" id="searchServiceTitle"></h1>
                <form class="search-form" id="searchForm">
                    <div class="form-group"><label for="searchDivision"><i class="fas fa-map-marker-alt"></i>বিভাগ</label><select id="searchDivision" class="form-control" required><option value="" disabled selected>বিভাগ নির্বাচন করুন</option></select></div>
                    <div class="form-group"><label for="searchDistrict"><i class="fas fa-map-marked-alt"></i>জেলা</label><select id="searchDistrict" class="form-control" disabled required><option value="" disabled selected>প্রথমে বিভাগ নির্বাচন করুন</option></select></div>
                    <div class="form-group"><label for="searchUpazila"><i class="fas fa-location-arrow"></i>উপজেলা</label><select id="searchUpazila" class="form-control" disabled required><option value="" disabled selected>প্রথমে জেলা নির্বাচন করুন</option></select></div>
                    <button type="submit" class="btn btn-primary search-btn"><i class="fas fa-search"></i> খুঁজুন</button>
                </form>
                <div class="back-link"><a id="goBackToEmergencyBtn" href="emergency_contract.html"><i class="fas fa-arrow-left"></i> ফিরে যান</a></div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Location Data
        const locationData = {
            barishal: { name: "বরিশাল", districts: { barguna: { name: "বরগুনা", upazilas: ["আমতলী", "বামনা", "বরগুনা সদর", "বেতাগী", "পাথরঘাটা", "তালতলী"] }, barishal: { name: "বরিশাল", upazilas: ["আগৈলঝাড়া", "বাবুগঞ্জ", "বাকেরগঞ্জ", "বানারীপাড়া", "গৌরনদী", "হিজলা", "বরিশাল সদর", "মেহেন্দিগঞ্জ", "মুলাদী", "উজিরপুর"] }, bhola: { name: "ভোলা", upazilas: ["ভোলা সদর", "বোরহানউদ্দিন", "চরফ্যাশন", "দৌলতখান", "লালমোহন", "মনপুরা", "তজুমদ্দিন"] }, jhalokati: { name: "ঝালকাঠি", upazilas: ["ঝালকাঠি সদর", "কাঁঠালিয়া", "নলছিটি", "রাজাপুর"] }, patuakhali: { name: "পটুয়াখালী", upazilas: ["বাউফল", "দশমিনা", "গলাচিপা", "কলাপাড়া", "মির্জাগঞ্জ", "পটুয়াখালী সদর", "দুমকি", "রাঙ্গাবালী"] }, pirojpur: { name: "পিরোজপুর", upazilas: ["ভান্ডারিয়া", "কাউখালী", "মঠবাড়িয়া", "নাজিরপুর", "পিরোজপুর সদর", "নেছারাবাদ", "ইন্দুরকানী"] } } },
            chattogram: { name: "চট্টগ্রাম", districts: { bandarban: { name: "বান্দরবান", upazilas: ["আলীকদম", "থানচি", "নাইক্ষ্যংছড়ি", "বান্দরবান সদর", "রুমা", "রোয়াংছড়ি", "লামা"] }, brahmanbaria: { name: "ব্রাহ্মণবাড়িয়া", upazilas: ["আখাউড়া", "আশুগঞ্জ", "বাঞ্ছারামপুর", "বিজয়নগর", "ব্রাহ্মণবাড়িয়া সদর", "কসবা", "নবীনগর", "নাসিরনগর", "সরাইল"] }, chandpur: { name: "চাঁদপুর", upazilas: ["চাঁদপুর সদর", "ফরিদগঞ্জ", "হাইমচর", "হাজীগঞ্জ", "কচুয়া", "মতলব উত্তর", "মতলব দক্ষিণ", "শাহরাস্তি"] }, chattogram: { name: "চট্টগ্রাম", upazilas: ["আনোয়ারা", "বাঁশখালী", "বোয়ালখালী", "চন্দনাইশ", "ফটিকছড়ি", "হাটহাজারী", "কর্ণফুলী", "লোহাগাড়া", "মীরসরাই", "পটিয়া", "রাঙ্গুনিয়া", "রাউজান", "সন্দ্বীপ", "সাতকানিয়া", "সীতাকুণ্ড", "আগ্রাবাদ", "কোতয়ালী", "চট্টগ্রাম সদর"] }, cumilla: { name: "কুমিল্লা", upazilas: ["বরুড়া", "ব্রাহ্মণপাড়া", "বুড়িচং", "চান্দিনা", "চৌদ্দগ্রাম", "দাউদকান্দি", "দেবিদ্বার", "হোমনা", "লাকসাম", "লালমাই", "মনোহরগঞ্জ", "মেঘনা", "মুরাদনগর", "নাঙ্গলকোট", "কুমিল্লা সদর", "কুমিল্লা সদর দক্ষিণ", "তিতাস"] }, coxsbazar: { name: "কক্সবাজার", upazilas: ["চকরিয়া", "কক্সবাজার সদর", "কুতুবদিয়া", "মহেশখালী", "পেকুয়া", "রামু", "টেকনাফ", "উখিয়া", "ঈদগাঁও"] }, feni: { name: "ফেনী", upazilas: ["ছাগলনাইয়া", "দাগনভূঞা", "ফেনী সদর", "পরশুরাম", "সোনাগাজী", "ফুলগাজী"] }, khagrachhari: { name: "খাগড়াছড়ি", upazilas: ["দীঘিনালা", "খাগড়াছড়ি সদর", "লক্ষ্মীছড়ি", "মহালছড়ি", "মানিকছড়ি", "মাটিরাঙ্গা", "পানছড়ি", "রামগড়", "গুইমারা"] }, lakshmipur: { name: "লক্ষ্মীপুর", upazilas: ["লক্ষ্মীপুর সদর", "রায়পুর", "রামগঞ্জ", "রামগতি", "কমলনগর"] }, noakhali: { name: "নোয়াখালী", upazilas: ["বেগমগঞ্জ", "চাটখিল", "কোম্পানীগঞ্জ", "হাতিয়া", "সেনবাগ", "সুবর্ণচর", "সোনাইমুড়ী", "কবিরহাট", "নোয়াখালী সদর"] }, rangamati: { name: "রাঙ্গামাটি", upazilas: ["বাঘাইছড়ি", "বরকল", "নানিয়ারচর", "কাপ্তাই", "কাউখালী", "লংগদু", "রাঙ্গামাটি সদর", "রাজস্থলী", "বিলাইছড়ি", "জুরাছড়ি"] } } },
            dhaka: { name: "ঢাকা", districts: { dhaka: { name: "ঢাকা", upazilas: ["সাভার", "ধামরাই", "কেরানীগঞ্জ", "নবাবগঞ্জ", "দোহার"] }, faridpur: { name: "ফরিদপুর", upazilas: ["ফরিদপুর সদর", "আলফাডাঙ্গা", "বোয়ালমারী", "মধুখালী", "নগরকান্দা", "সালথা", "ভাঙ্গা", "চরভদ্রাসন", "সদরপুর"] }, gazipur: { name: "গাজীপুর", upazilas: ["গাজীপুর সদর", "কালিয়াকৈর", "কালীগঞ্জ", "কাপাসিয়া", "শ্রীপুর"] }, gopalganj: { name: "গোপালগঞ্জ", upazilas: ["গোপালগঞ্জ সদর", "কাশিয়ানী", "কোটালীপাড়া", "মুকসুদপুর", "টুঙ্গিপাড়া"] }, kishoreganj: { name: "কিশোরগঞ্জ", upazilas: ["অষ্টগ্রাম", "বাজিতপুর", "ভৈরব", "হোসেনপুর", "ইটনা", "করিমগঞ্জ", "কটিয়াদী", "কিশোরগঞ্জ সদর", "কুলিয়ারচর", "মিঠামইন", "নিকলী", "পাকুন্দিয়া", "তাড়াইল"] }, madaripur: { name: "মাদারীপুর", upazilas: ["কালকিনি", "মাদারীপুর সদর", "রাজৈর", "শিবচর", "ডাসার"] }, manikganj: { name: "মানিকগঞ্জ", upazilas: ["দৌলতপুর", "ঘিওর", "হরিরামপুর", "মানিকগঞ্জ সদর", "সাটুরিয়া", "শিবালয়", "সিঙ্গাইর"] }, munshiganj: { name: "মুন্সিগঞ্জ", upazilas: ["গজারিয়া", "লৌহজং", "মুন্সিগঞ্জ সদর", "সিরাজদিখান", "শ্রীনগর", "টঙ্গিবাড়ী"] }, narayanganj: { name: "নারায়ণগঞ্জ", upazilas: ["আড়াইহাজার", "বন্দর", "নারায়ণগঞ্জ সদর", "রূপগঞ্জ", "সোনারগাঁও"] }, narsingdi: { name: "নরসিংদী", upazilas: ["বেলাবো", "মনোহরদী", "নরসিংদী সদর", "পলাশ", "রায়পুরা", "শিবপুর"] }, rajbari: { name: "রাজবাড়ী", upazilas: ["বালিয়াকান্দি", "গোয়ালন্দ", "পাংশা", "কালুখালী", "রাজবাড়ী সদর"] }, shariatpur: { name: "শরীয়তপুর", upazilas: ["ভেদরগঞ্জ", "ডামুড্যা", "গোসাইরহাট", "নড়িয়া", "শরীয়তপুর সদর", "জাজিরা"] }, tangail: { name: "টাঙ্গাইল", upazilas: ["বাসাইল", "ভুঞাপুর", "দেলদুয়ার", "ঘাটাইল", "গোপালপুর", "কালিহাতী", "মধুপুর", "মির্জাপুর", "নাগরপুর", "সখিপুর", "টাঙ্গাইল সদর", "ধনবাড়ী"] } } },
            khulna: { name: "খুলনা", districts: { bagerhat: { name: "বাগেরহাট", upazilas: ["বাগেরহাট সদর", "চিতলমারী", "ফকিরহাট", "কচুয়া", "মোল্লাহাট", "মোংলা", "মোরেলগঞ্জ", "রামপাল", "শরণখোলা"] }, chuadanga: { name: "চুয়াডাঙ্গা", upazilas: ["আলমডাঙ্গা", "চুয়াডাঙ্গা সদর", "দামুড়হুদা", "জীবননগর"] }, jashore: { name: "যশোর", upazilas: ["অভয়নগর", "বাঘারপাড়া", "চৌগাছা", "ঝিকরগাছা", "কেশবপুর", "যশোর সদর", "মণিরামপুর", "শার্শা"] }, jhenaidah: { name: "ঝিনাইদহ", upazilas: ["হরিণাকুণ্ডু", "ঝিনাইদহ সদর", "কালীগঞ্জ", "কোটচাঁদপুর", "মহেশপুর", "শৈলকুপা"] }, khulna: { name: "খুলনা", upazilas: ["বটিয়াঘাটা", "দাকোপ", "ডুমুরিয়া", "দিঘলিয়া", "কয়রা", "পাইকগাছা", "ফুলতলা", "রূপসা", "তেরখাদা", "নিউমার্কেট", "সোনাডাঙ্গা"] }, kushtia: { name: "কুষ্টিয়া", upazilas: ["ভেড়ামারা", "দৌলতপুর", "খোকসা", "কুমারখালী", "কুষ্টিয়া সদর", "মিরপুর"] }, magura: { name: "মাগুরা", upazilas: ["মাগুরা সদর", "মহম্মদপুর", "শালিখা", "শ্রীপুর"] }, meherpur: { name: "মেহেরপুর", upazilas: ["গাংনী", "মেহেরপুর সদর", "মুজিবনগর"] }, narail: { name: "নড়াইল", upazilas: ["কালিয়া", "লোহাগড়া", "নড়াইল সদর"] }, satkhira: { name: "সাতক্ষীরা", upazilas: ["আশাশুনি", "দেবহাটা", "কলারোয়া", "কালীগঞ্জ", "সাতক্ষীরা সদর", "শ্যামনগর", "তালা"] } } },
            mymensingh: { name: "ময়মনসিংহ", districts: { jamalpur: { name: "জামালপুর", upazilas: ["বকশীগঞ্জ", "দেওয়ানগঞ্জ", "ইসলামপুর", "জামালপুর সদর", "মাদারগঞ্জ", "মেলান্দহ", "সরিষাবাড়ী"] }, mymensingh: { name: "ময়মনসিংহ", upazilas: ["ভালুকা", " ত্রিশাল", "হালুয়াঘাট", "মুক্তাগাছা", "ধোবাউড়া", "ফুলবাড়ীয়া", "গফরগাঁও", "গৌরীপুর", "ঈশ্বরগঞ্জ", "ময়মনসিংহ সদর", "নান্দাইল", "ফুলপুর", "তারাকান্দা"] }, netrokona: { name: "নেত্রকোণা", upazilas: ["আটপাড়া", "বারহাট্টা", "দুর্গাপুর", "খালিয়াজুরী", "কলমাকান্দা", "কেন্দুয়া", "মদন", "মোহনগঞ্জ", "নেত্রকোণা সদর", "পূর্বধলা"] }, sherpur: { name: "শেরপুর", upazilas: ["ঝিনাইগাতী", "নকলা", "নালিতাবাড়ী", "শেরপুর সদর", "শ্রীবরদী"] } } },
            rajshahi: { name: "রাজশাহী", districts: { bogura: { name: "বগুড়া", upazilas: ["আদমদীঘি", "বগুড়া সদর", "ধুনট", "দুপচাঁচিয়া", "গাবতলী", "কাহালু", "নন্দীগ্রাম", "সারিয়াকান্দি", "শাজাহানপুর", "শেরপুর", "শিবগঞ্জ", "সোনাতলা"] }, chapainawabganj: { name: "চাঁপাইনবাবগঞ্জ", upazilas: ["ভোলাহাট", "গোমস্তাপুর", "নাচোল", "নবাবগঞ্জ সদর", "শিবগঞ্জ"] }, joypurhat: { name: "জয়পুরহাট", upazilas: ["আক্কেলপুর", "জয়পুরহাট সদর", "কালাই", "ক্ষেতলাল", "পাঁচবিবি"] }, naogaon: { name: "নওগাঁ", upazilas: ["আত্রাই", "বদলগাছী", "ধামইরহাট", "মান্দা", "মহাদেবপুর", "নওগাঁ সদর", "নিয়ামতপুর", "পত্নীতলা", "পোরশা", "রানীনগর", "সাপাহার"] }, natore: { name: "নাটোর", upazilas: ["বাগাতিপাড়া", "বড়াইগ্রাম", "গুরুদাসপুর", "লালপুর", "নাটোর সদর", "সিংড়া", "নলডাঙ্গা"] }, pabna: { name: "পাবনা", upazilas: ["আটঘরিয়া", "বেড়া", "ভাঙ্গুড়া", "চাটমোহর", "ফরিদপুর", "ঈশ্বরদী", "pabna সদর", "সাঁথিয়া", "সুজানগর"] }, rajshahi: { name: "রাজশাহী", upazilas: ["বাঘা", "বাগমারা", "চারঘাট", "দুর্গাপুর", "গোদাগাড়ী", "মোহনপুর", "পবা", "পুঠিয়া", "তানোর", "রাজশাহী বিশ্ববিদ্যালয়"] }, sirajganj: { name: "সিরাজগঞ্জ", upazilas: ["বেলকুচি", "চৌহালী", "কামারখন্দ", "কাজীপুর", "রায়গঞ্জ", "শাহজাদপুর", "সিরাজগঞ্জ সদর", "তাড়াশ", "উল্লাপাড়া"] } } },
            rangpur: { name: "রংপুর", districts: { dinajpur: { name: "দিনাজপুর", upazilas: ["বিরামপুর", "বীরগঞ্জ", "বিরল", "বোচাগঞ্জ", "চিরিরবন্দর", "ফুলবাড়ী", "ঘোড়াঘাট", "হাকিমপুর", "কাহারোল", "খানসামা", "দিনাজপুর সদর", "নবাবগঞ্জ", "পার্বতীপুর"] }, gaibandha: { name: "গাইবান্ধা", upazilas: ["ফুলছড়ি", "গাইবান্ধা সদর", "গোবিন্দগঞ্জ", "পলাশবাড়ী", "সাদুল্লাপুর", "সাঘাটা", "সুন্দরগঞ্জ"] }, kurigram: { name: "কুড়িগ্রাম", upazilas: ["ভুরুঙ্গামারী", "চর রাজিবপুর", "চিলমারী", "ফুলবাড়ী", "কুড়িগ্রাম সদর", "নাগেশ্বরী", "রাজারহাট", "রৌমারী", "উলিপুর"] }, lalmonirhat: { name: "লালমনিরহাট", upazilas: ["আদিতমারী", "হাতীবান্ধা", "কালীগঞ্জ", "লালমনিরহাট সদর", "পাটগ্রাম"] }, nilphamari: { name: "নীলফামারী", upazilas: ["ডোমার", "ডিমলা", "জলঢাকা", "কিশোরগঞ্জ", "নীলফামারী সদর", "সৈয়দপুর"] }, panchagarh: { name: "পঞ্চগড়", upazilas: ["আটোয়ারী", "বোদা", "দেবীগঞ্জ", "পঞ্চগড় সদর", "তেঁতুলিয়া"] }, rangpur: { name: "রংপুর", upazilas: ["বদরগঞ্জ", "গঙ্গাচড়া", "কাউনিয়া", "রংপুর সদর", "মিঠাপুকুর", "পীরগাছা", "পীরগঞ্জ", "তারাগঞ্জ"] }, thakurgaon: { name: "ঠাকুরগাঁও", upazilas: ["বালিয়াডাঙ্গী", "হরিপুর", "পীরগঞ্জ", "রানীশংকৈল", "ঠাকুরগাঁও সদর"] } } },
            sylhet: { name: "সিলেট", districts: { habiganj: { name: "হবিগঞ্জ", upazilas: ["আজমিরীগঞ্জ", "বাহুবল", "বানিয়াচং", "চুনারুঘাট", "হবিগঞ্জ সদর", "লাখাই", "মাধবপুর", "নবীগঞ্জ", "শায়েস্তাগঞ্জ"] }, moulvibazar: { name: "মৌলভীবাজার", upazilas: ["বড়লেখা", "জুড়ী", "কমলগঞ্জ", "কুলাউড়া", "মৌলভীবাজার সদর", "রাজনগর", "শ্রীমঙ্গল"] }, sunamganj: { name: "সুনামগঞ্জ", upazilas: ["বিশ্বম্ভরপুর", "ছাতক", "দিরাই", "দোয়ারাবাজার", "জগন্নাথপুর", "জামালগঞ্জ", "শাল্লা", "সুনামগঞ্জ সদর", "তাহিরপুর", "ধর্মপাশা", "দক্ষিণ সুনামগঞ্জ", "মধ্যনগর"] }, sylhet: { name: "সিলেট", upazilas: ["বালাগঞ্জ", "বিয়ানীবাজার", "বিশ্বনাথ", "কোম্পানীগঞ্জ", "ফেঞ্চুগঞ্জ", "গোলাপগঞ্জ", "গোয়াইনঘাট", "জৈন্তাপুর", "কানাইঘাট", "সিলেট সদর", "জকিগঞ্জ", "দক্ষিণ সুরমা", "ওসমানী নগর", "আম্বরখানা", "জিন্দাবাজার"] } } }
        };

        // DOM Elements
        const searchForm = document.getElementById('searchForm');
        const searchServiceTitle = document.getElementById('searchServiceTitle');
        const searchDivisionSelect = document.getElementById('searchDivision');
        const searchDistrictSelect = document.getElementById('searchDistrict');
        const searchUpazilaSelect = document.getElementById('searchUpazila');
        
        // Get service type from previous page (emergency_contract.html)
        let currentService = localStorage.getItem('currentService');
        
        // --- Utility Functions ---
        const getDivisionNameByKey = (key) => locationData[key] ? locationData[key].name : '';
        const getDistrictNameByKey = (divKey, distKey) => locationData[divKey] && locationData[divKey].districts[distKey] ? locationData[divKey].districts[distKey].name : '';

        const populateDivisions = (selectElement) => {
            selectElement.innerHTML = '<option value="" disabled selected>বিভাগ নির্বাচন করুন</option>';
            for (const key in locationData) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = locationData[key].name;
                selectElement.appendChild(option);
            }
        };

        const populateDistricts = (divKey, distSelect, upazilaSelect) => {
            distSelect.innerHTML = '<option value="" disabled selected>জেলা নির্বাচন করুন</option>';
            upazilaSelect.innerHTML = '<option value="" disabled selected>প্রথমে জেলা নির্বাচন করুন</option>';
            distSelect.disabled = !divKey;
            upazilaSelect.disabled = true;
            if (divKey && locationData[divKey]) {
                const districts = locationData[divKey].districts;
                for (const key in districts) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = districts[key].name;
                    distSelect.appendChild(option);
                }
            }
        };

        const populateUpazilas = (divKey, distKey, upazilaSelect) => {
            upazilaSelect.innerHTML = '<option value="" disabled selected>উপজেলা নির্বাচন করুন</option>';
            upazilaSelect.disabled = !distKey;
            if (divKey && distKey && locationData[divKey].districts[distKey]) {
                const upazilas = locationData[divKey].districts[distKey].upazilas;
                upazilas.forEach(upazila => {
                    const option = document.createElement('option');
                    option.value = upazila;
                    option.textContent = upazila;
                    upazilaSelect.appendChild(option);
                });
            }
        };
        
        // --- Initialization ---
        if (!currentService) {
            window.location.href = 'index.html'; 
            return;
        }

        searchServiceTitle.innerHTML = `<i class="fas fa-search"></i> ${currentService} সন্ধান`;
        populateDivisions(searchDivisionSelect);

        // --- Event Listeners ---
        searchDivisionSelect.addEventListener('change', () => populateDistricts(searchDivisionSelect.value, searchDistrictSelect, searchUpazilaSelect));
        searchDistrictSelect.addEventListener('change', () => populateUpazilas(searchDivisionSelect.value, searchDistrictSelect.value, searchUpazilaSelect));

        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const divisionKey = searchDivisionSelect.value;
            const districtKey = searchDistrictSelect.value;
            const upazila = searchUpazilaSelect.value;
            if (!divisionKey || !districtKey || !upazila) return;

            const divisionName = getDivisionNameByKey(divisionKey);
            const districtName = getDistrictNameByKey(divisionKey, districtKey);
            
            // Save search context for the results page
            const searchContext = { 
                divisionName, 
                districtName, 
                upazila, 
                currentService,
                divisionKey, 
                districtKey
            };
            
            localStorage.setItem('searchContext', JSON.stringify(searchContext));

            // Redirect to results page
            window.location.href = 'cont_search_result.html';
        });
    });
    </script>
</body>
</html>