<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>রক্তদাতার বিবরণ - আমাদের জন্য আমরা</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
      import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDu8VDVXEbrLbqPmD24OPgNhbH5xjwi_vA",
        authDomain: "we4usnur.firebaseapp.com",
        projectId: "we4usnur",
        storageBucket: "we4usnur.firebasestorage.app",
        messagingSenderId: "1069907132834",
        appId: "1:1069907132834:web:f6aec92fc61c413767f2fb",
        measurementId: "G-LZCCHNFRSN"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      window.db = db;
      window.doc = doc;
      window.getDoc = getDoc;
      window.auth = auth;
      window.onAuthStateChanged = onAuthStateChanged;
    </script>

    <style>
        /* --- General/Shared Styles (Consistent with index.html) --- */
        :root {
            --primary: #e53935;
            --primary-dark: #c62828;
            --secondary: #f5f5f5;
            --text: #333;
            --text-light: #666;
            --white: #fff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--secondary); color: var(--text); line-height: 1.6; }
        .container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .btn { padding: 10px 20px; border-radius: 30px; font-weight: 600; cursor: pointer; transition: var(--transition); border: none; font-size: 0.9rem; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: var(--white); }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background: var(--primary); color: var(--white); }
        
        /* Header & Nav */
        header { background-color: var(--white); box-shadow: var(--shadow); position: sticky; top: 0; z-index: 1000; }
        .header-content { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; }
        .logo { display: flex; align-items: center; gap: 10px; color: var(--primary); font-weight: 700; font-size: 1.5rem; text-decoration: none; }
        .logo i { font-size: 1.8rem; }
        nav ul { display: flex; list-style: none; gap: 25px; }
        nav a { text-decoration: none; color: var(--text); font-weight: 500; transition: var(--transition); position: relative; }
        nav a:hover { color: var(--primary); }
        
        /* Detail Page Specific Styles */
        .details-section { padding: 60px 0; min-height: 80vh; display: flex; align-items: center; }
        .details-container { background: var(--white); border-radius: 20px; box-shadow: var(--shadow); padding: 40px; width: 100%; max-width: 800px; margin: 0 auto; position: relative; overflow: hidden; }
        .details-container::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: linear-gradient(90deg, var(--primary), var(--primary-dark)); }
        
        .profile-header { text-align: center; margin-bottom: 40px; border-bottom: 1px solid #eee; padding-bottom: 30px; }
        .avatar-placeholder { width: 100px; height: 100px; background: #ffebee; color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; margin: 0 auto 20px; }
        .donor-name-large { font-size: 2.2rem; font-weight: 700; color: var(--text); margin-bottom: 5px; }
        .donor-location-large { font-size: 1.1rem; color: var(--text-light); display: flex; align-items: center; justify-content: center; gap: 8px; }
        
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; }
        .info-item { background: #f9f9f9; padding: 20px; border-radius: 12px; border-left: 4px solid var(--primary); transition: var(--transition); }
        .info-item:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .info-label { font-size: 0.9rem; color: var(--text-light); display: block; margin-bottom: 5px; }
        .info-value { font-size: 1.2rem; font-weight: 600; color: var(--text); display: flex; align-items: center; gap: 10px; }
        .blood-badge { background: var(--primary); color: var(--white); padding: 2px 10px; border-radius: 15px; font-size: 1rem; }
        
        .action-buttons { margin-top: 40px; text-align: center; display: flex; justify-content: center; gap: 20px; }
        .copy-btn { background: none; border: none; color: var(--primary); cursor: pointer; font-size: 1rem; }
        .loading-text { text-align: center; font-size: 1.2rem; color: var(--text-light); padding: 50px; }
        .error-text { text-align: center; font-size: 1.2rem; color: var(--primary); padding: 50px; }

        /* Footer */
        footer { background: #2c3e50; color: var(--white); padding: 60px 0 20px; }
        .copyright { text-align: center; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); font-size: 0.9rem; color: #aaa; }

        @media (max-width: 768px) {
            .details-container { padding: 25px; }
            .donor-name-large { font-size: 1.8rem; }
            .info-grid { grid-template-columns: 1fr; }
            .action-buttons { flex-direction: column; }
            .header-content nav { display: none; } /* Simple mobile view handling */
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo"> <i class="fas fa-tint"></i> <span>আমাদের জন্য আমরা</span> </a>
                <nav>
                    <ul>
                        <li><a href="index.html">হোম</a></li>
                        <li><a href="index.html#donors">রক্তদাতা</a></li>
                        <li><a href="emergency_contract.html">জরুরি যোগাযোগ</a></li>
                        <li><a href="emergency_page.html">ইমারজেন্সি ব্লাড</a></li>
                    </ul>
                </nav>
                <a href="index.html" class="btn btn-primary">ব্যাক</a>
            </div>
        </div>
    </header>

    <main>
        <section class="details-section">
            <div class="container">
                <div id="donorDetailsContainer" class="details-container">
                    <div class="loading-text">তথ্য লোড হচ্ছে...</div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="copyright"><p>&copy; ২০২৫ আমাদের জন্য আমরা. সকল অধিকার সংরক্ষিত।</p></div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Location Data for Bengali translation
            const locationData = { "barishal": { "name": "বরিশাল" }, "chattogram": { "name": "চট্টগ্রাম" }, "dhaka": { "name": "ঢাকা" }, "khulna": { "name": "খুলনা" }, "mymensingh": { "name": "ময়মনসিংহ" }, "rajshahi": { "name": "রাজশাহী" }, "rangpur": { "name": "রংপুর" }, "sylhet": { "name": "সিলেট" } };

            // 1. Get ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const donorId = urlParams.get('id');
            const container = document.getElementById('donorDetailsContainer');

            // Helper: Calculate Age
            function calculateAge(birthDateValue) {
                if (!birthDateValue) return 'অজানা';
                const birthDate = new Date(birthDateValue);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) { age--; }
                return age;
            }

            // Helper: Translate Gender
            function translateGender(gender) {
                if(gender === 'male') return 'পুরুষ';
                if(gender === 'female') return 'মহিলা';
                return 'অন্যান্য';
            }

            // 2. Fetch Data
            if (!donorId) {
                container.innerHTML = '<div class="error-text">কোনো দাতার আইডি পাওয়া যায়নি। দয়া করে তালিকা থেকে আবার চেষ্টা করুন।</div>';
            } else {
                fetchDonorDetails(donorId);
            }

            async function fetchDonorDetails(id) {
                try {
                    const docRef = window.doc(window.db, "users", id);
                    const docSnap = await window.getDoc(docRef);

                    if (docSnap.exists()) {
                        renderDonorProfile(docSnap.data());
                    } else {
                        container.innerHTML = '<div class="error-text">দুঃখিত, এই রক্তদাতার তথ্য পাওয়া যায়নি বা মুছে ফেলা হয়েছে।</div>';
                    }
                } catch (error) {
                    console.error("Error fetching document:", error);
                    container.innerHTML = '<div class="error-text">ডাটা লোড করতে সমস্যা হয়েছে। ইন্টারনেট সংযোগ চেক করুন।</div>';
                }
            }

            function renderDonorProfile(data) {
                // Privacy Check (Optional: Usually details page shows what's public)
                if (data.isPublished === false) {
                    container.innerHTML = '<div class="error-text">এই রক্তদাতার প্রোফাইলটি বর্তমানে প্রাইভেট করা আছে।</div>';
                    return;
                }

                const age = calculateAge(data.birthDate);
                const divName = locationData[data.division]?.name || data.division || '';
                const locationFull = `${data.upazila || ''}, ${data.district || ''}, ${divName}`;
                const lastDonation = data.neverDonated ? 'কখনও রক্ত দেননি' : (data.lastDonation ? new Date(data.lastDonation).toLocaleDateString('bn-BD') : 'তথ্য নেই');
                
                const html = `
                    <div class="profile-header">
                        <div class="avatar-placeholder"><i class="fas fa-user"></i></div>
                        <h1 class="donor-name-large">${data.name}</h1>
                        <div class="donor-location-large"><i class="fas fa-map-marker-alt"></i> ${locationFull}</div>
                    </div>

                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">রক্তের গ্রুপ</span>
                            <div class="info-value"><span class="blood-badge">${data.bloodGroup}</span></div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">মোবাইল নম্বর</span>
                            <div class="info-value">
                                <span id="phoneDisplay">${data.mobile}</span>
                                <button class="copy-btn" onclick="copyPhone('${data.mobile}')" title="কপি করুন"><i class="far fa-copy"></i></button>
                            </div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">শেষ রক্তদান</span>
                            <div class="info-value"><i class="fas fa-calendar-check" style="color: var(--primary); font-size: 1rem;"></i> ${lastDonation}</div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">বয়স</span>
                            <div class="info-value">${age} বছর</div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">জেন্ডার</span>
                            <div class="info-value">${translateGender(data.gender)}</div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ওজন</span>
                            <div class="info-value">${data.weight || '-'} কেজি</div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <a href="tel:${data.mobile}" class="btn btn-primary" style="min-width: 200px;">
                            <i class="fas fa-phone-alt"></i> কল করুন
                        </a>
                    </div>
                `;
                container.innerHTML = html;
            }

            // Copy Function attached to window for HTML access
            window.copyPhone = (number) => {
                navigator.clipboard.writeText(number).then(() => {
                    alert('নম্বরটি কপি করা হয়েছে: ' + number);
                }).catch(err => {
                    alert('কপি করতে ব্যর্থ হয়েছে।');
                });
            };
        });
    </script>
</body>
</html>
